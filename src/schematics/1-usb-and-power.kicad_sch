(kicad_sch (version 20230121) (generator eeschema)

  (uuid 9af4e6f3-104a-4ca1-b63f-2bed43663d8c)

  (paper "A3")

  (title_block
    (rev "0.1")
    (company "Pete Restall <pete@restall.net>")
  )

  (lib_symbols
  )

  (bus_alias "USBC_MCU" (members "D_{+}" "D_{-}"))

  (text "TODO: VCONN FOR FUSB302 - JUST TIE TO REGULATED 3.3V ALONG WITH VDD - NOT PARTICULARLY IMPORTANT FOR SINKS, THIS DOES WORK (HACKADAY ARTICLE ON USB PD DOES THE SAME)."
    (at 81.28 82.296 0)
    (effects (font (size 1.27 1.27)) (justify left bottom))
    (uuid 0aca639c-4e0c-4e27-87c0-15fcdb6ff4ba)
  )
  (text "TODO: Whilst the device will _support_ USB Suspend, it cannot actually achieve the 2.5mA limit - the DPS1133 voltage monitor / switch will draw a minimum of 1.5mA quiescent.\nWhat we can do - which seems to be compliant - is to issue a RESUME after 5ms of inactivity (3ms of inactivity triggers the SUSPEND).  This is remote wake-up.  It's not a particularly\ngood thing to do since it requires hubs that are otherwise globally suspended to wake up, increasing power consumption across the entire bus.  This isn't really in the spirit of the\nrule so maybe make the RESUME an optional flag that can be toggled by the user, even though the device will draw more than 2.5mA in strict contravention of the standard.  But that way\nat least we won't be forcing bus up-down-up-down cycles and we can still achieve something close to the 2.5mA."
    (at 85.09 71.882 0)
    (effects (font (size 1.27 1.27)) (justify left bottom))
    (uuid 87256329-9f15-4bd4-8800-d9f8f5031c33)
  )
  (text "TODO: POWER SUPPLIES.\n\nTPS62441 is a dual buck converter - two independent outputs with high switching frequency (ie. low value / small inductors).\n\nOne output should be an always-enabled +3.3V -> LC pi filter -> digital\nOne output should be an MCU-enabled +3.954V_{absmin} -> LC pi filter -> TPS7A20 -> +3.6V -> analogue (radio and vrefs)\n\nFor pi filters, use L with SRF >> 2.5MHz (preferably > 100MHz since spikes are high dV/dT), otherwise effectiveness is reduced.\n\nBefore pi filters, leave room for an optional RC snubber, with (for the analogue rail) an optional RC filter after / just before the LDO:\n\n--+------+--L--+----R--+------+------> LDO\n  R      C     C       C     Rfb\n  C      |     |       |      +------> SMPS\n GND    GND   GND     GND    Rfb\n                             GND\n\nFeedback V for SMPS _includes_ the filters in the loop.  Note that R might need to handle _very_ big I^{2}R if LDO is shorted.\n\nThese are 1A parts (or a 2A part for the TPS62442) so ensure that the digital supply can handle the current / power dissipation - do a power budget before settling on it.\n\nhttps://www.analog.com/en/technical-articles/designing-second-stage-output-filters-for-switching-power-supplies.html\n\n\nA TPS7A2028 ought to get about 250mA from the +3.3V digital line (for the sensors - the humidity sensor can take about 135mA).\n"
    (at 138.176 209.804 0)
    (effects (font (size 1.27 1.27)) (justify left bottom))
    (uuid fe9916fc-cb74-4240-bc3f-5e1e429c2f63)
  )

  (hierarchical_label "{USBC_CONN}" (shape bidirectional) (at 66.04 119.38 180) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify right))
    (uuid 1b428699-d9e4-4117-a3ca-df9494e18633)
  )
  (hierarchical_label "~{USBC_INT}" (shape output) (at 152.4 129.54 0) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid 2a5c0dbe-6ce0-49e9-babf-1717b4678ec1)
  )
  (hierarchical_label "USBC_VBUS" (shape input) (at 50.8 101.346 180) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify right))
    (uuid 3466903d-599c-4106-9604-7a2de81da32a)
  )
  (hierarchical_label "{USBC_MCU}" (shape bidirectional) (at 126.746 101.346 0) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid 4d0d4477-67b0-46e5-914b-fb5085d8fd0b)
  )
  (hierarchical_label "{I^{2}C}" (shape bidirectional) (at 76.2 127.254 180) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify right))
    (uuid b9236eca-c964-4b8d-ad0f-dea95c3f861c)
  )
  (hierarchical_label "~{USB_PWRFAULT}" (shape output) (at 152.4 127 0) (fields_autoplaced)
    (effects (font (size 1.27 1.27)) (justify left))
    (uuid bf24b739-8dc3-4272-aa67-c2c0f5ababcf)
  )
)
